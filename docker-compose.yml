services:
  app:
    build: .
    container_name: nuxt3-dev
    working_dir: /app
    volumes:
      - .:/app                            # entire project (so package.json is available)
      - node_modules:/app/node_modules    # container-owned node_modules
      - nuxt_build:/app/.nuxt            # container-owned .nuxt build dir
    ports:
      - "3000:3000"
    environment:
      - CHOKIDAR_USEPOLLING=true
      - VITE_HOST=0.0.0.0
      - VITE_SERVER_WATCH_POLLING=true
      - NITRO_WATCHERS_POLLING=1
    command: >
      sh -c "
        if [ ! -x node_modules/.bin/nuxt ]; then
          echo 'node_modules missing or nuxt not installed, running npm install...';
          npm install;
        fi;
        npm run dev -- --host 0.0.0.0
      "
    stdin_open: true
    tty: true

volumes:
  node_modules:
  nuxt_build:

#services:
#  app:
#    build: .
#    container_name: nuxt3-dev
#    working_dir: /app
#    volumes:
#      - .:/app
#      - /app/node_modules
#    ports:
#      - "3000:3000"
#    environment:
#      - CHOKIDAR_USEPOLLING=true
#      - VITE_HOST=0.0.0.0
#    command: npm run dev -- --host 0.0.0.0
#    stdin_open: true
#    tty: true
